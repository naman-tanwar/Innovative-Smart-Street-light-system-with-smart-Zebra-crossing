ORG 0000H
LJMP TIMERSET
;-ISR-----TIMER 0
ORG 000BH ;TIMER0 INTERUPT VECTOR TABLE
	JNB P1.0, DAYTIME;During daytime P1.0=0
	JB P1.1, CROSSON
	CLR P1.2
	RETI
	CROSSON: SETB P1.2
	RETI
	DAYTIME:
	CLR P1.2
	CLR A
	MOV P0,A
	JNB P1.0, DAYTIME
	RETI
TIMERSET:
MOV TMOD, #02H
MOV TH0, #0ACH
MOV IE, #82H
SETB TR0
MOV P2,#0FFH ;P2 AS INPUT

MAINLOOP:
CLR A
MOV P0,A
JNB P1.0, MAINLOOP ;During daytime P1.0=0
JB P2.7,CHECK7
JB P2.6,CHECK6
JB P2.5,CHECK5
JB P2.4,CHECK4
JB P2.3,CHECK3
JB P2.2,CHECK2
JB P2.1,CHECK1
JB P2.0,CHECK0
SJMP MAINLOOP

CHECK7:
SETB P0.7
JB P2.6, BACK
SJMP CHECK7

CHECK6:
SETB P0.6
JB P2.7, Forward
JB P2.5, BACK
SJMP CHECK6

CHECK5:
SETB P0.5
JB P2.6, Forward
JB P2.4, BACK
SJMP CHECK5

CHECK4:
SETB P0.4
JB P2.5, Forward
JB P2.3, BACK
SJMP CHECK4

CHECK3:
SETB P0.3
JB P2.4, Forward
JB P2.2, BACK
SJMP CHECK3

CHECK2:
SETB P0.2
JB P2.3, Forward
JB P2.1, BACK
SJMP CHECK2

CHECK1:
SETB P0.1
JB P2.2, Forward
JB P2.0, BACK
SJMP CHECK1

CHECK0:
SETB P0.0
JB P2.1, Forward
SJMP CHECK0

BACK:
JMP Backward
SJMP BACK

Forward:
CLR A
MOV R0,A 
LOOP:CLR A
MOV P0,A
JB P2.7,LABEL8
JB P2.6,LABEL7
JB P2.5,LABEL6
JB P2.4,LABEL5
JB P2.3,LABEL4
JB P2.2,LABEL3
JB P2.1,LABEL2
JB P2.0,LABEL1
INC R0
CJNE R0, #254, CHK
SJMP LOOP
CHK:
JNC CH1
SJMP LOOP
CH1: JMP MAINLOOP

LABEL1:
SETB P0.0
SETB P0.1
SETB P0.2
SJMP LOOP
LABEL2:
SETB P0.1
SETB P0.2
SETB P0.3
SJMP LOOP
LABEL3:
SETB P0.2
SETB P0.3
SETB P0.4
SJMP LOOP
LABEL4:
SETB P0.3
SETB P0.4
SETB P0.5
SJMP LOOP
LABEL5:
SETB P0.4
SETB P0.5
SETB P0.6
SJMP LOOP
LABEL6:
SETB P0.5
SETB P0.6
SETB P0.7
SJMP LOOP
LABEL7:
SETB P0.6
SETB P0.7
SJMP LOOP
LABEL8:
SETB P0.7
SJMP LOOP

;---------------

Backward:
CLR A
MOV R0,A 
LOOP2:CLR A
MOV P0,A
JB P2.0,LABEL12
JB P2.1,LABEL22
JB P2.2,LABEL32
JB P2.3,LABEL42
JB P2.4,LABEL52
JB P2.5,LABEL62
JB P2.6,LABEL72
JB P2.7,LABEL82
INC R0
CJNE R0, #254, CHK2
SJMP LOOP2
CHK2:
JNC CH2
SJMP LOOP2
CH2: JMP MAINLOOP
SJMP LOOP2

LABEL12:
SETB P0.0
SJMP LOOP2
LABEL22:
SETB P0.1
SETB P0.0
SJMP LOOP2
LABEL32:
SETB P0.2
SETB P0.1
SETB P0.0
SJMP LOOP2
LABEL42:
SETB P0.3
SETB P0.2
SETB P0.1
SJMP LOOP2
LABEL52:
SETB P0.4
SETB P0.3
SETB P0.2
SJMP LOOP2
LABEL62:
SETB P0.5
SETB P0.4
SETB P0.3
SJMP LOOP2
LABEL72:
SETB P0.6
SETB P0.5
SETB P0.4
SJMP LOOP2
LABEL82:
SETB P0.7
SETB P0.6
SETB P0.5
SJMP LOOP2



END